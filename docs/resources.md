## Resources

## Bundle

An image contains an arbitrary set of files or directories. Ultimately, an image is a tarball of all the provided inputs.

A bundle is an image with some additional characteristics:
- Contains both files/directories along with references to dependant images
- Contains a bundle directory (`.imgpkg/`), which must exist at the root-level of the bundle and
  contains info about the bundle
  
`imgpkg` tries to be helpful to ensure that bundles are referenced and constructed correctly, so it will error if any incompatibilities arise.

### `.imgpkg` directory

There are a few restrictions when creating a bundle:

* Only one `.imgpkg` directory is allowed across all directories provided via `-f`. This restriction ensures there is a single source of bundle metadata and referenced images.

* The `.imgpkg` directory must be a direct child of one of the input directories. This prevents any confusion around the scope that the `.imgpkg` metadata applies to.

* The `.imgpkg` directory must contain a **required** [ImagesLock](resources.md#imageslock) file named `images.yml` that contains 0+ referenced images. This provides a guarantee to consumers that the files will always be present and is safe to rely on in automation that consumes bundles.

* An optional [Bundle Metadata](#bundle-metadata) file that stores metadata describing the bundle.

A bundle directory has this structure:

```
.imgpkg/
  bundle.yml
  images.yml
```

### Bundle Metadata

Used by bundle creators to store general information about the bundle.

```yaml
apiVersion: imgpkg.carvel.dev/v1alpha1
kind: Bundle
metadata:
  name: my-app
authors:
- name: blah
  email: blah@example.com
websites:
- url: example.com
```

### ImagesLock

An ImagesLock file is used to store image references. Bundles have an ImagesLock file containing the list of images referenced by the bundle.
When relocating a bundle, `imgpkg` uses the ImagesLock file to relocate dependent images based on their references.

Users can relocate a batch of images with an ImagesLock file and the `--lock` flag in a [`copy`](commands.md#copying-via-lock-files) command.
The ImagesLock file guarantees immutability when relocating its referenced images by referring to each image with a digest.

```yaml
apiVersion: imgpkg.carvel.dev/v1alpha1
kind: ImagesLock
spec:
  images:
  - image: docker.io/my-app@sha256:42462d0cb227497976754bb67348bdd7471c7bd159819d6bd63fdf479eb7eb19
    annotaions:
      kbld.carvel.dev/id: "my-app:v1"
  - image: docker.io/another-app@sha256:6ecba6f14373a449f8d54fa4286f57fb8ef37c4ffa637969551f2fda52672206
```

---
## BundleLock

Stores a deterministic reference to a bundle as well as the tag it was pushed with. These file is generated by `imgpkg push -b ... --lock-output /tmp/lock.yml` command.

```yaml
apiVersion: imgpkg.carvel.dev/v1alpha1
kind: BundleLock
spec:
  image:
    url: docker.io/my-app@sha256:b12026c7a0a6a1756a82a2a74ac759e9a7036523faca0e33dbddebc214e097df
    tag: v1.0
```
